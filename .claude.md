# Lead Research SaaS Platform - Claude Configuration

> **Note:** This file is auto-loaded by Claude. All guidelines below are automatically in context.

## üìÅ Repository Information

**GitHub Repository:**
- **Owner:** C9-Tech-GtitHub
- **Repository:** Lead
- **Main Branch:** main
- **Remote URL:** https://github.com/C9-Tech-GtitHub/Lead.git

**IMPORTANT:** Always use `C9-Tech-GtitHub` as the owner when pushing code via GitHub MCP tools.

## ‚ö†Ô∏è IMPORTANT: Bash Command Restrictions

**NEVER use bash commands that scan these directories:**
- `node_modules/`, `.next/`, `.git/`, `dist/`, `build/`, `out/`, `coverage/`

**Bad:** `grep -r "pattern" .` or `find . -name "*.ts"`

**Good:** Use exclusions or use Grep/Glob tools instead:
```bash
grep -r "pattern" --exclude-dir={node_modules,.git,.next,dist,build,out,coverage}
find . -name "*.ts" -not -path "*/node_modules/*" -not -path "*/.next/*"
```

**Why:** Scanning these directories wastes 85%+ of context tokens on dependency code and build artifacts.

---

## Tech Stack Overview

- **Framework:** Next.js 14 (App Router, TypeScript)
- **Styling:** Tailwind CSS (with custom theme)
- **Icons:** lucide-react
- **Database & Auth:** Supabase (PostgreSQL, Supabase Auth, Realtime)
- **Background Jobs:** Inngest (async task processing)
- **AI:** OpenAI GPT-5 mini (`gpt-5-mini` model)
- **API Integrations:**
  - **Serpdog:** Google Maps scraping
  - **Firecrawl:** Website content extraction
  - **SendGrid:** Email marketing integration
- **CSV Parsing:** csv-parse
- **Maps:** Leaflet + react-leaflet
- **State Management:** React hooks (no Redux, no MobX)
- **Validation:** Zod schemas

## Library Usage Rules

1. **Styling:**  
   - Use Tailwind CSS utility classes for all styling
   - Do not use CSS-in-JS, styled-components, or SCSS
   - Use `clsx` and `tailwind-merge` for conditional class names

2. **Icons:**  
   - Use only lucide-react for all icons

3. **Forms:**  
   - Use native React forms with Zod for validation
   - Do not introduce react-hook-form unless explicitly required

4. **State Management:**  
   - Use React hooks (`useState`, `useEffect`, etc.) for local state
   - Do not introduce Redux, MobX, or Zustand

5. **Database/API:**  
   - Use the Supabase client from `lib/supabase/` for all database and authentication operations
   - Do not use Prisma, Firebase, or direct SQL queries (except via migrations)

6. **Background Jobs:**  
   - Use Inngest for all async/background processing
   - Define functions in `lib/inngest/`

7. **AI Integration:**  
   - Always use GPT-5 mini (`gpt-5-mini` model)
   - Follow best practices from `GPT5-BEST-PRACTICES.md`
   - Use `reasoning_effort: 'low'` for structured tasks
   - Do not use `temperature` or `top_p` (not supported in GPT-5)

8. **Maps:**  
   - Use Leaflet + react-leaflet for all map functionality
   - Use dynamic imports for map components (avoid SSR issues)

9. **CSV Handling:**  
   - Use csv-parse for all CSV parsing

10. **API Integrations:**
    - Follow best practices guides:
      - Serpdog ‚Üí `SCRAPINGDOG-BEST-PRACTICES.md`
      - Firecrawl ‚Üí `FIRECRAWL-BEST-PRACTICES.md`
      - GPT-5 ‚Üí `GPT5-BEST-PRACTICES.md`
    - See `API-BEST-PRACTICES-SUMMARY.md` for quick reference

**General Rule:**  
If a pattern or utility is documented in the best practices guides, always follow it. Don't introduce new dependencies without justification.

---

## Common Commands

- **npm run dev**: Start Next.js development server (http://localhost:3000)
- **npm run build**: Build the Next.js app for production
- **npm run start**: Start the production server
- **npm run lint**: Run ESLint to check for code issues
- **npm run migrate**: Run database migration scripts
- **npx inngest-cli dev**: Start Inngest Dev Server for local background job processing

## Project Structure

- **app/**: Next.js App Router pages, layouts, and route handlers
  - **auth/**: Authentication pages (login, signup)
  - **dashboard/**: Main application dashboard
  - **api/inngest/**: Inngest webhook endpoint
- **components/**: Custom React components
  - **auth/**: Authentication components
  - **dashboard/**: Dashboard UI components
  - **runs/**: Research run and lead components
- **lib/**: Core business logic and utilities
  - **supabase/**: Supabase client configuration
  - **inngest/**: Inngest functions (background jobs)
  - **scrapers/**: Google Maps & website scrapers
  - **ai/**: GPT-5 integration and analysis
- **supabase/**: Database schemas and migrations
- **scripts/**: Utility scripts (migrations, etc.)

## Key Files

- **lib/supabase/**: Supabase client setup - use for all database operations
- **lib/inngest/**: Background job definitions (scraping, AI analysis)
- **lib/ai/**: GPT-5 integration following best practices
- **GPT5-BEST-PRACTICES.md**: Required reading for AI features
- **API-BEST-PRACTICES-SUMMARY.md**: Quick reference for all API integrations
- **supabase/schema.sql**: Database schema (runs, leads, profiles tables)

## Code Style Guidelines

- Use ES modules (import/export), not CommonJS (require)
- Prefer named exports over default exports for components
- Use functional components with hooks, not class components
- Destructure props in function parameters
- Use TypeScript types for all function parameters and return values
- Prefer `const` over `let` when variables won't be reassigned
- Use Zod for runtime validation and type inference
- Always handle errors from Supabase: `const { data, error } = await supabase...`

## Development Workflow

### üîÑ **DEFAULT WORKFLOW FOR ALL TASKS** (Test ‚Üí Fix ‚Üí Deploy ‚Üí Verify)

**Unless explicitly told otherwise, ALWAYS follow this workflow for every task/fix:**

1. **üìã Create Task Tracking**
   - Use TodoWrite to break down the task
   - Track progress throughout

2. **üîç Test Locally First** (if applicable)
   - Test and reproduce the issue on localhost:3000
   - Verify the bug/behavior exists

3. **üõ†Ô∏è Implement Fix**
   - Make code changes
   - Follow project code style guidelines
   - Use appropriate MCPs (Supabase, GitHub, etc.)

4. **‚úÖ Verify Fix Locally**
   - Test on localhost:3000
   - Run `npm run lint` to check code quality
   - Ensure no console errors
   - Test with Inngest Dev Server if background jobs involved

5. **üöÄ Deploy to GitHub**
   - Commit changes with clear message
   - Push to main branch (or create PR if specified)
   - Wait for Vercel deployment to complete

6. **üåê Verify on Live Site**
   - Test the production deployment
   - Verify the fix works in production
   - Check for any deployment-specific issues

7. **üìù Document & Report**
   - Update task tracking as completed
   - Provide summary of changes
   - Report any issues found

**This workflow ensures:**
- ‚úÖ Issues are reproduced before fixing
- ‚úÖ Fixes work locally before deployment
- ‚úÖ Production deployment is verified
- ‚úÖ No surprises after deployment

---

### Additional Development Guidelines

- **IMPORTANT**: Always run `npm run lint` after making code changes
- Test Supabase connections before committing database-related changes
- Check browser console for runtime errors during development
- Run `npm run build` to catch TypeScript errors before committing
- When working with Inngest functions:
  - Test locally with `npx inngest-cli dev`
  - Check Inngest Dev Server UI at http://localhost:8288
  - Verify function triggers and event payloads

## Supabase Best Practices

- Always destructure and check for errors: `const { data, error } = await supabase...`
- Handle errors appropriately - show user-friendly messages
- Use the shared Supabase client from `lib/supabase/`
- Never hardcode Supabase credentials - use environment variables
- Use RLS policies for security (see `supabase/schema.sql`)
- Enable Realtime for `runs` and `leads` tables for live updates
- Use `npm run migrate` for database schema changes

## GPT-5 Integration Best Practices

**CRITICAL:** Always follow `GPT5-BEST-PRACTICES.md` when working with AI features.

**Required Configuration:**
```typescript
{
  model: 'gpt-5-mini',
  reasoning_effort: 'low',  // For structured tasks like lead analysis
  verbosity: 'medium',       // Balanced output
  max_completion_tokens: 2000
}
```

**DO NOT USE:**
- ‚ùå `temperature` (not supported in GPT-5)
- ‚ùå `top_p` (not supported in GPT-5)
- ‚ùå `reasoning_effort: 'high'` or 'max' (expensive, not needed for structured tasks)

**Cost Optimization:**
- GPT-5 mini: ~$0.0125 per lead analyzed
- Use `reasoning_effort: 'low'` (default) for structured tasks
- Set appropriate `max_completion_tokens` limits

## API Integration Best Practices

### Serpdog (Google Maps Scraping)
- Endpoint: `https://api.scrapingdog.com/google_maps`
- Cost: ~$0.0025 per result
- See `SCRAPINGDOG-BEST-PRACTICES.md` for optimization

### Firecrawl (Website Scraping)
- Endpoint: `https://api.firecrawl.dev/v1/scrape`
- Cost: ~$0.001 per page
- See `FIRECRAWL-BEST-PRACTICES.md` for optimization

### SendGrid (Email Marketing)
- API Key required in environment variables
- Bulk operations should be batched
- See implementation in `app/api/sendgrid/` routes

**Always refer to `API-BEST-PRACTICES-SUMMARY.md` for quick reference on all APIs.**

## Environment Variables

Required environment variables (see `.env.example`):
- `NEXT_PUBLIC_SUPABASE_URL`: Supabase project URL
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`: Supabase publishable/anon key
- `SCRAPINGDOG_API_KEY`: Serpdog API key
- `FIRECRAWL_API_KEY`: Firecrawl API key
- `OPENAI_API_KEY`: OpenAI API key (GPT-5 access)
- `INNGEST_EVENT_KEY`: Inngest event key (production)
- `INNGEST_SIGNING_KEY`: Inngest signing key (production)
- `SENDGRID_API_KEY`: SendGrid API key

## Database Schema

### Main Tables
- **profiles**: User profiles (extends Supabase Auth users)
- **runs**: Research run metadata, progress tracking, grade distribution
- **leads**: Individual business leads with AI analysis and grades

### Key Features
- Row Level Security (RLS) enabled on all tables
- Realtime enabled on `runs` and `leads` for live updates
- User-scoped data access via RLS policies

See `supabase/schema.sql` for complete schema.

## MCP Servers (Model Context Protocol)

This project uses several MCP servers for enhanced capabilities. These are automatically available when working with Claude.

### üíª ACP (Agent Communication Protocol) (`mcp__acp__*`)

**Purpose:** Local file system and command execution

**When to Use:**
- ALWAYS use these for local file operations
- Reading files from the project
- Writing/editing local files  
- Running bash commands
- Managing background processes

**Key Tools:**
- `Read` - Read local files (ALWAYS use this instead of bash cat)
- `Write` - Create/overwrite files
- `Edit` - String replacement in files
- `Bash` - Execute shell commands
- `BashOutput` - Get output from background commands
- `KillShell` - Stop background processes

**Important:**
- NEVER use bash commands for file reading (use `Read` instead)
- NEVER use echo/cat to create files (use `Write` instead)
- ALWAYS use `Edit` for targeted changes to existing files

### üì¶ Supabase MCP (`mcp__supabase__*`)

**Purpose:** Database operations and backend management

**When to Use:**
- Querying the database
- Applying migrations
- Checking table schemas
- Viewing database logs
- Managing projects and organizations
- Executing SQL queries

**Key Tools:**
- `list_tables` - View database schema
- `execute_sql` - Run SQL queries (SELECT, INSERT, UPDATE, DELETE)
- `apply_migration` - Apply DDL changes (CREATE, ALTER, DROP)
- `get_logs` - View application logs
- `list_projects` - List Supabase projects
- `get_advisors` - Check for security/performance issues

**Important:**
- ALWAYS use `apply_migration` for DDL (CREATE, ALTER, DROP)
- Use `execute_sql` only for DML (SELECT, INSERT, UPDATE, DELETE)
- Run `get_advisors` after schema changes to check for issues

### üìö Context7 MCP (`mcp__mcp-server-context7__*`)

**Purpose:** Library documentation lookup

**When to Use:**
- Looking up Next.js documentation
- Finding React patterns
- Checking Supabase API docs
- Learning library-specific features

**Key Tools:**
- `resolve-library-id` - Find library by name
- `get-library-docs` - Get documentation

## MCP Best Practices

### File Operations
‚úÖ **DO:** Use `mcp__acp__Read` to read local files
‚ùå **DON'T:** Use `cat` or `head` commands

‚úÖ **DO:** Use `mcp__acp__Write` to create files
‚ùå **DON'T:** Use `echo >` or heredocs

‚úÖ **DO:** Use `mcp__acp__Edit` for targeted changes
‚ùå **DON'T:** Read entire file, modify, then write back

### Database Operations
‚úÖ **DO:** Use `apply_migration` for schema changes
‚ùå **DON'T:** Use `execute_sql` for DDL

‚úÖ **DO:** Run `get_advisors` after migrations
‚ùå **DON'T:** Forget to check for security issues

### Testing & Debugging
‚úÖ **DO:** Test on both localhost and production
‚úÖ **DO:** Check Inngest Dev Server for background job status
‚úÖ **DO:** Verify Realtime updates work in browser

### Deployment
‚úÖ **DO:** Use git push to deploy via Vercel's GitHub integration
‚úÖ **DO:** Check build logs in Vercel dashboard if deployment fails
‚úÖ **DO:** Verify deployment on live URL after push
‚úÖ **DO:** Ensure Inngest webhook is registered in production

## Quick Reference

| Task | Command/Tool |
|------|-------------|
| Read a local file | `mcp__acp__Read` |
| Edit a local file | `mcp__acp__Edit` |
| Run a command | `mcp__acp__Bash` |
| Query database | `mcp__supabase__execute_sql` |
| Change schema | `mcp__supabase__apply_migration` |
| Look up docs | `mcp__mcp-server-context7__get-library-docs` |
| Start dev server | `npm run dev` |
| Start Inngest | `npx inngest-cli dev` |
| Run migrations | `npm run migrate` |

## Important Documentation Files

When working on specific features, always refer to these guides:

- **GPT-5 Integration:** `GPT5-BEST-PRACTICES.md` (REQUIRED reading)
- **API Summary:** `API-BEST-PRACTICES-SUMMARY.md`
- **Google Maps Scraping:** `SCRAPINGDOG-BEST-PRACTICES.md`
- **Website Scraping:** `FIRECRAWL-BEST-PRACTICES.md`
- **City Search:** `CITY_SEARCH_IMPLEMENTATION.md`
- **LinkedIn Integration:** `LINKEDIN_INTEGRATION.md`
- **ABN Validation:** `ABN_CHECKER.md`
- **Deployment:** `DEPLOYMENT.md`
- **Team Access:** `APPLY_TEAM_ACCESS.md`

## Troubleshooting

### "No response from GPT-5"
- Check `OPENAI_API_KEY` is valid
- Ensure GPT-5 access is enabled
- Review `GPT5-BEST-PRACTICES.md`

### Inngest functions not triggering
- Local: Ensure `npx inngest-cli dev` is running
- Production: Verify keys in Vercel environment
- Check Inngest dashboard for function logs

### Realtime updates not working
- Ensure Realtime enabled for `runs` and `leads` tables
- Check RLS policies in `supabase/schema.sql`

### API errors (Serpdog, Firecrawl)
- Verify API keys in environment
- Check account credits/limits
- Review relevant best practices guide

---

**Built with Next.js, Supabase, Inngest, and GPT-5 mini**
